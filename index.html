<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculateur d'H√©ritage Islamique Complet</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #2c3e50 0%, #3498db 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            opacity: 0.9;
            font-size: 1.1em;
        }

        .content {
            padding: 30px;
        }

        .form-section {
            margin-bottom: 30px;
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
        }

        h2 {
            color: #2c3e50;
            margin-bottom: 20px;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
        }

        h3 {
            color: #2c3e50;
            margin: 15px 0 10px 0;
            font-size: 1.2em;
        }

        .form-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2c3e50;
        }

        input, select {
            width: 100%;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        input:focus, select:focus {
            outline: none;
            border-color: #3498db;
        }

        .form-row {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
        }

        .form-row .form-group {
            flex: 1;
        }

        .btn {
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            font-size: 18px;
            cursor: pointer;
            transition: transform 0.2s;
            width: 100%;
            margin-top: 10px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .results {
            margin-top: 30px;
            padding: 25px;
            background: #f8f9fa;
            border-radius: 10px;
            border-left: 5px solid #3498db;
            display: none;
        }

        .heir-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            margin: 10px 0;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .heir-name {
            font-weight: 600;
            color: #2c3e50;
        }

        .heir-share {
            font-weight: 600;
            color: #27ae60;
        }

        .warning {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .note {
            background: #d1ecf1;
            border: 1px solid #bee5eb;
            color: #0c5460;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            font-size: 0.9em;
        }

        .tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 1px solid #ddd;
        }

        .tab {
            padding: 12px 20px;
            cursor: pointer;
            background: #f1f1f1;
            border: 1px solid #ddd;
            border-bottom: none;
            border-radius: 5px 5px 0 0;
            margin-right: 5px;
        }

        .tab.active {
            background: #3498db;
            color: white;
            border-color: #3498db;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .sub-section {
            margin-left: 20px;
            padding: 15px;
            background: white;
            border-radius: 8px;
            margin-bottom: 15px;
        }

        .spouse-section {
            background: #e8f4f8;
            border-left: 4px solid #3498db;
        }

        @media (max-width: 768px) {
            .container {
                margin: 10px;
            }
            
            .header h1 {
                font-size: 2em;
            }
            
            .content {
                padding: 20px;
            }
            
            .form-row {
                flex-direction: column;
                gap: 0;
            }
            
            .sub-section {
                margin-left: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üïå Calculateur d'H√©ritage Islamique Complet</h1>
            <p>Calcul des parts successorales selon le droit musulman - Tous les h√©ritiers inclus</p>
        </div>

        <div class="content">
            <div class="warning">
                ‚ö†Ô∏è <strong>Note importante :</strong> Ce calculateur fournit une estimation selon les r√®gles g√©n√©rales du droit successoral musulman. Pour les cas complexes, consultez un expert en droit islamique.
            </div>

            <div class="tabs">
                <div class="tab active" onclick="switchTab('defunt')">D√©funt</div>
                <div class="tab" onclick="switchTab('heritiers')">H√©ritiers</div>
                <div class="tab" onclick="switchTab('resultats')">R√©sultats</div>
            </div>

            <div id="defunt" class="tab-content active">
                <div class="form-section">
                    <h2>üìã Informations sur le d√©funt</h2>
                    <div class="form-group">
                        <label for="estateValue">Valeur totale de la succession (en ‚Ç¨)</label>
                        <input type="number" id="estateValue" placeholder="Entrez le montant total" min="0">
                    </div>
                    <div class="form-group">
                        <label for="deceasedGender">Genre du d√©funt</label>
                        <select id="deceasedGender" onchange="toggleSpouseFields()">
                            <option value="male">Homme</option>
                            <option value="female">Femme</option>
                        </select>
                    </div>
                </div>
                <button class="btn" onclick="switchTab('heritiers')">Suivant ‚Üí</button>
            </div>

            <div id="heritiers" class="tab-content">
                <div class="form-section spouse-section">
                    <h2>üíë Conjoint</h2>
                    
                    <div id="husbandField" class="form-group" style="display: none;">
                        <label>√âpoux</label>
                        <select id="husband">
                            <option value="absent">Absent</option>
                            <option value="present">Pr√©sent</option>
                        </select>
                    </div>

                    <div id="wivesField" class="form-group">
                        <label>√âpouse(s)</label>
                        <select id="wives">
                            <option value="0">Aucune</option>
                            <option value="1">1 √©pouse</option>
                            <option value="2">2 √©pouses</option>
                            <option value="3">3 √©pouses</option>
                            <option value="4">4 √©pouses</option>
                        </select>
                    </div>
                </div>

                <div class="form-section">
                    <h2>üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Enfants directs</h2>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>Fils(s)</label>
                            <input type="number" id="sons" placeholder="Nombre" min="0" value="0">
                        </div>
                        <div class="form-group">
                            <label>Fille(s)</label>
                            <input type="number" id="daughters" placeholder="Nombre" min="0" value="0">
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <h2>üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Parents</h2>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>P√®re</label>
                            <select id="father">
                                <option value="absent">Absent</option>
                                <option value="present">Pr√©sent</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>M√®re</label>
                            <select id="mother">
                                <option value="absent">Absent</option>
                                <option value="present">Pr√©sent</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <h2>üë∂ Petits-enfants</h2>
                    <div class="note">
                        üí° Les petits-enfants n'h√©ritent qu'en l'absence de leurs propres parents (enfants du d√©funt)
                    </div>
                    
                    <div class="sub-section">
                        <h3>Par fils d√©funt</h3>
                        <div class="form-row">
                            <div class="form-group">
                                <label>Petits-fils (par fils)</label>
                                <input type="number" id="grandsonsBySon" placeholder="Nombre" min="0" value="0">
                            </div>
                            <div class="form-group">
                                <label>Petites-filles (par fils)</label>
                                <input type="number" id="granddaughtersBySon" placeholder="Nombre" min="0" value="0">
                            </div>
                        </div>
                    </div>

                    <div class="sub-section">
                        <h3>Par fille d√©funte</h3>
                        <div class="form-row">
                            <div class="form-group">
                                <label>Petits-fils (par fille)</label>
                                <input type="number" id="grandsonsByDaughter" placeholder="Nombre" min="0" value="0">
                            </div>
                            <div class="form-group">
                                <label>Petites-filles (par fille)</label>
                                <input type="number" id="granddaughtersByDaughter" placeholder="Nombre" min="0" value="0">
                            </div>
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <h2>üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Fr√®res et s≈ìurs</h2>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>Fr√®res germains</label>
                            <input type="number" id="fullBrothers" placeholder="Nombre" min="0" value="0">
                        </div>
                        <div class="form-group">
                            <label>S≈ìurs germaines</label>
                            <input type="number" id="fullSisters" placeholder="Nombre" min="0" value="0">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>Fr√®res paternels</label>
                            <input type="number" id="paternalBrothers" placeholder="Nombre" min="0" value="0">
                        </div>
                        <div class="form-group">
                            <label>S≈ìurs paternelles</label>
                            <input type="number" id="paternalSisters" placeholder="Nombre" min="0" value="0">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>Fr√®res maternels</label>
                            <input type="number" id="maternalBrothers" placeholder="Nombre" min="0" value="0">
                        </div>
                        <div class="form-group">
                            <label>S≈ìurs maternelles</label>
                            <input type="number" id="maternalSisters" placeholder="Nombre" min="0" value="0">
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <h2>üë¥ Grands-parents</h2>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>Grand-p√®re paternel</label>
                            <select id="paternalGrandfather">
                                <option value="absent">Absent</option>
                                <option value="present">Pr√©sent</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Grand-m√®re paternelle</label>
                            <select id="paternalGrandmother">
                                <option value="absent">Absent</option>
                                <option value="present">Pr√©sent</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>Grand-p√®re maternel</label>
                            <select id="maternalGrandfather">
                                <option value="absent">Absent</option>
                                <option value="present">Pr√©sent</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Grand-m√®re maternelle</label>
                            <select id="maternalGrandmother">
                                <option value="absent">Absent</option>
                                <option value="present">Pr√©sent</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="form-row">
                    <button class="btn" onclick="switchTab('defunt')">‚Üê Pr√©c√©dent</button>
                    <button class="btn" onclick="calculateInheritance()">üßÆ Calculer les parts</button>
                </div>
            </div>

            <div id="resultats" class="tab-content">
                <div id="results" class="results">
                    <h2>üìä R√©sultats du calcul</h2>
                    <div id="heirsList"></div>
                    <div class="note">
                        üí° <strong>Rappel :</strong> Les calculs sont bas√©s sur les r√®gles du Coran et de la Sunna. 
                        Les petits-enfants n'h√©ritent qu'en l'absence de leurs parents directs (enfants du d√©funt).
                        En cas de pr√©sence de fils, les filles re√ßoivent la moiti√© de la part d'un fils (syst√®me du 'Asabah).
                    </div>
                </div>
                <button class="btn" onclick="switchTab('heritiers')">‚Üê Modifier les h√©ritiers</button>
            </div>
        </div>
    </div>

    <script>
        // Fonction pour basculer entre √©pouse(s) et √©poux
        function toggleSpouseFields() {
            const deceasedGender = document.getElementById('deceasedGender').value;
            const husbandField = document.getElementById('husbandField');
            const wivesField = document.getElementById('wivesField');
            
            if (deceasedGender === 'female') {
                // D√©funte femme - afficher √©poux, cacher √©pouses
                husbandField.style.display = 'block';
                wivesField.style.display = 'none';
                document.getElementById('wives').value = '0';
            } else {
                // D√©funt homme - afficher √©pouses, cacher √©poux
                husbandField.style.display = 'none';
                wivesField.style.display = 'block';
                document.getElementById('husband').value = 'absent';
            }
        }

        // Initialiser l'affichage au chargement
        document.addEventListener('DOMContentLoaded', function() {
            toggleSpouseFields();
        });

        function switchTab(tabName) {
            // Masquer tous les onglets
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // D√©sactiver tous les onglets
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Activer l'onglet s√©lectionn√©
            document.getElementById(tabName).classList.add('active');
            
            // Activer le bouton d'onglet correspondant
            document.querySelectorAll('.tab').forEach(tab => {
                if (tab.textContent.includes(getTabText(tabName))) {
                    tab.classList.add('active');
                }
            });
            
            // Si on passe √† l'onglet r√©sultats, calculer l'h√©ritage
            if (tabName === 'resultats') {
                calculateInheritance();
            }
        }
        
        function getTabText(tabName) {
            const tabTexts = {
                'defunt': 'D√©funt',
                'heritiers': 'H√©ritiers',
                'resultats': 'R√©sultats'
            };
            return tabTexts[tabName];
        }

        function calculateInheritance() {
            // R√©cup√©ration des valeurs
            const estateValue = parseFloat(document.getElementById('estateValue').value);
            const deceasedGender = document.getElementById('deceasedGender').value;
            
            // Conjoint - diff√©rent selon le genre du d√©funt
            let husbandsCount = 0;
            let wivesCount = 0;
            
            if (deceasedGender === 'female') {
                husbandsCount = document.getElementById('husband').value === 'present' ? 1 : 0;
                wivesCount = 0;
            } else {
                husbandsCount = 0;
                wivesCount = parseInt(document.getElementById('wives').value);
            }
            
            const sonsCount = parseInt(document.getElementById('sons').value);
            const daughtersCount = parseInt(document.getElementById('daughters').value);
            const fatherPresent = document.getElementById('father').value === 'present';
            const motherPresent = document.getElementById('mother').value === 'present';
            
            // Petits-enfants
            const grandsonsBySonCount = parseInt(document.getElementById('grandsonsBySon').value);
            const granddaughtersBySonCount = parseInt(document.getElementById('granddaughtersBySon').value);
            const grandsonsByDaughterCount = parseInt(document.getElementById('grandsonsByDaughter').value);
            const granddaughtersByDaughterCount = parseInt(document.getElementById('granddaughtersByDaughter').value);
            
            // Fr√®res et s≈ìurs
            const fullBrothersCount = parseInt(document.getElementById('fullBrothers').value);
            const fullSistersCount = parseInt(document.getElementById('fullSisters').value);
            const paternalBrothersCount = parseInt(document.getElementById('paternalBrothers').value);
            const paternalSistersCount = parseInt(document.getElementById('paternalSisters').value);
            const maternalBrothersCount = parseInt(document.getElementById('maternalBrothers').value);
            const maternalSistersCount = parseInt(document.getElementById('maternalSisters').value);
            
            // Grands-parents
            const paternalGrandfatherPresent = document.getElementById('paternalGrandfather').value === 'present';
            const paternalGrandmotherPresent = document.getElementById('paternalGrandmother').value === 'present';
            const maternalGrandfatherPresent = document.getElementById('maternalGrandfather').value === 'present';
            const maternalGrandmotherPresent = document.getElementById('maternalGrandmother').value === 'present';

            // Validation
            if (!estateValue || estateValue <= 0) {
                alert('Veuillez entrer une valeur valide pour la succession');
                switchTab('defunt');
                return;
            }

            let heirs = [];
            let totalShares = 0;

            // CALCUL DES PARTS FIXES (ZHAWI AL-FURUD)

            // √âPOUSE(S) - pour d√©funt homme
            if (wivesCount > 0) {
                let wifeShare;
                const hasDescendants = sonsCount > 0 || daughtersCount > 0 || 
                    grandsonsBySonCount > 0 || granddaughtersBySonCount > 0 ||
                    grandsonsByDaughterCount > 0 || granddaughtersByDaughterCount > 0;
                
                if (hasDescendants) {
                    wifeShare = 1/8; // 1/8 s'il y a des descendants
                } else {
                    wifeShare = 1/4; // 1/4 s'il n'y a pas de descendants
                }
                const sharePerWife = wifeShare / wivesCount;
                heirs.push({
                    name: `√âpouse${wivesCount > 1 ? 's' : ''}`,
                    share: sharePerWife,
                    amount: (estateValue * sharePerWife * wivesCount).toFixed(2),
                    count: wivesCount,
                    type: 'fixed'
                });
                totalShares += wifeShare;
            }

            // √âPOUX - pour d√©funte femme
            if (husbandsCount > 0) {
                let husbandShare;
                const hasDescendants = sonsCount > 0 || daughtersCount > 0 || 
                    grandsonsBySonCount > 0 || granddaughtersBySonCount > 0 ||
                    grandsonsByDaughterCount > 0 || granddaughtersByDaughterCount > 0;
                
                if (hasDescendants) {
                    husbandShare = 1/4; // 1/4 s'il y a des descendants
                } else {
                    husbandShare = 1/2; // 1/2 s'il n'y a pas de descendants
                }
                
                heirs.push({
                    name: '√âpoux',
                    share: husbandShare,
                    amount: (estateValue * husbandShare).toFixed(2),
                    count: 1,
                    type: 'fixed'
                });
                totalShares += husbandShare;
            }

            // P√àRE
            if (fatherPresent) {
                let fatherShare;
                const hasDescendants = sonsCount > 0 || daughtersCount > 0 || 
                    grandsonsBySonCount > 0 || granddaughtersBySonCount > 0 ||
                    grandsonsByDaughterCount > 0 || granddaughtersByDaughterCount > 0;
                
                if (hasDescendants) {
                    fatherShare = 1/6; // 1/6 s'il y a des descendants
                } else {
                    // 1/6 + le reste comme 'Asabah
                    const remainingAfterFixed = 1 - totalShares;
                    fatherShare = 1/6 + (remainingAfterFixed - 1/6 > 0 ? remainingAfterFixed - 1/6 : 0);
                }
                heirs.push({
                    name: 'P√®re',
                    share: fatherShare,
                    amount: (estateValue * fatherShare).toFixed(2),
                    count: 1,
                    type: 'fixed'
                });
                totalShares += fatherShare;
            }

            // M√àRE
            if (motherPresent) {
                let motherShare;
                const siblingsCount = fullBrothersCount + fullSistersCount + paternalBrothersCount + 
                                     paternalSistersCount + maternalBrothersCount + maternalSistersCount;
                const hasDescendants = sonsCount > 0 || daughtersCount > 0 || 
                    grandsonsBySonCount > 0 || granddaughtersBySonCount > 0 ||
                    grandsonsByDaughterCount > 0 || granddaughtersByDaughterCount > 0;
                
                if (hasDescendants || siblingsCount >= 2 || fatherPresent) {
                    motherShare = 1/6; // 1/6 dans la plupart des cas
                } else {
                    motherShare = 1/3; // 1/3 s'il n'y a pas de descendants, p√®re, et moins de 2 fr√®res/s≈ìurs
                }
                heirs.push({
                    name: 'M√®re',
                    share: motherShare,
                    amount: (estateValue * motherShare).toFixed(2),
                    count: 1,
                    type: 'fixed'
                });
                totalShares += motherShare;
            }

            // ENFANTS DIRECTS (syst√®me du 'Asabah) - PRIORIT√â 1
            const childrenCount = sonsCount + daughtersCount;
            if (childrenCount > 0) {
                const remainingShare = 1 - totalShares;
                if (remainingShare > 0) {
                    // Un fils re√ßoit le double d'une fille
                    const daughterUnit = daughtersCount;
                    const sonUnit = sonsCount * 2;
                    const totalUnits = daughterUnit + sonUnit;
                    const sharePerUnit = remainingShare / totalUnits;

                    if (sonsCount > 0) {
                        const sonShare = sharePerUnit * 2;
                        heirs.push({
                            name: `Fils${sonsCount > 1 ? 's' : ''}`,
                            share: sonShare * sonsCount,
                            amount: (estateValue * sonShare * sonsCount).toFixed(2),
                            count: sonsCount,
                            type: 'asabah'
                        });
                    }

                    if (daughtersCount > 0) {
                        const daughterShare = sharePerUnit;
                        heirs.push({
                            name: `Fille${daughtersCount > 1 ? 's' : ''}`,
                            share: daughterShare * daughtersCount,
                            amount: (estateValue * daughterShare * daughtersCount).toFixed(2),
                            count: daughtersCount,
                            type: 'asabah'
                        });
                    }
                    
                    totalShares += remainingShare;
                }
            }
            // PETITS-ENFANTS - PRIORIT√â 2 (seulement si pas d'enfants directs)
            else {
                const grandsonsCount = grandsonsBySonCount + grandsonsByDaughterCount;
                const granddaughtersCount = granddaughtersBySonCount + granddaughtersByDaughterCount;
                const grandchildrenCount = grandsonsCount + granddaughtersCount;
                
                if (grandchildrenCount > 0) {
                    const remainingShare = 1 - totalShares;
                    if (remainingShare > 0) {
                        // Seuls les petits-enfants par fils h√©ritent (selon l'√©cole hanafite)
                        if (grandsonsBySonCount > 0 || granddaughtersBySonCount > 0) {
                            const daughterUnit = granddaughtersBySonCount;
                            const sonUnit = grandsonsBySonCount * 2;
                            const totalUnits = daughterUnit + sonUnit;
                            const sharePerUnit = remainingShare / totalUnits;
                            
                            if (grandsonsBySonCount > 0) {
                                const grandsonShare = sharePerUnit * 2;
                                heirs.push({
                                    name: `Petit-fils (par fils)${grandsonsBySonCount > 1 ? 's' : ''}`,
                                    share: grandsonShare * grandsonsBySonCount,
                                    amount: (estateValue * grandsonShare * grandsonsBySonCount).toFixed(2),
                                    count: grandsonsBySonCount,
                                    type: 'asabah'
                                });
                            }
                            
                            if (granddaughtersBySonCount > 0) {
                                const granddaughterShare = sharePerUnit;
                                heirs.push({
                                    name: `Petite-fille (par fils)${granddaughtersBySonCount > 1 ? 's' : ''}`,
                                    share: granddaughterShare * granddaughtersBySonCount,
                                    amount: (estateValue * granddaughterShare * granddaughtersBySonCount).toFixed(2),
                                    count: granddaughtersBySonCount,
                                    type: 'asabah'
                                });
                            }
                            
                            totalShares += remainingShare;
                        }
                        // Petits-enfants par fille (selon certaines √©coles)
                        else if (grandsonsByDaughterCount > 0 || granddaughtersByDaughterCount > 0) {
                            heirs.push({
                                name: `Petits-enfants (par fille)`,
                                share: 0,
                                amount: '0.00',
                                count: grandsonsByDaughterCount + granddaughtersByDaughterCount,
                                type: 'excluded',
                                note: 'Non h√©ritants selon la majorit√© des √©coles en pr√©sence d\'autres h√©ritiers'
                            });
                        }
                    }
                }
            }

            // FR√àRES ET S≈íURS - PRIORIT√â 3
            if (childrenCount === 0 && !fatherPresent && 
                grandsonsBySonCount === 0 && granddaughtersBySonCount === 0) {
                
                // Fr√®res et s≈ìurs germains
                if (fullBrothersCount > 0 || fullSistersCount > 0) {
                    const remainingShare = 1 - totalShares;
                    if (remainingShare > 0) {
                        if (fullSistersCount === 0) {
                            // Seuls des fr√®res germains
                            const sharePerBrother = remainingShare / fullBrothersCount;
                            heirs.push({
                                name: `Fr√®re germain${fullBrothersCount > 1 ? 's' : ''}`,
                                share: sharePerBrother * fullBrothersCount,
                                amount: (estateValue * sharePerBrother * fullBrothersCount).toFixed(2),
                                count: fullBrothersCount,
                                type: 'asabah'
                            });
                        } else if (fullBrothersCount === 0 && fullSistersCount === 1) {
                            // Une seule s≈ìur germaine - 1/2
                            const sisterShare = 1/2;
                            heirs.push({
                                name: 'S≈ìur germaine',
                                share: sisterShare,
                                amount: (estateValue * sisterShare).toFixed(2),
                                count: 1,
                                type: 'fixed'
                            });
                            totalShares += sisterShare;
                        } else if (fullBrothersCount === 0 && fullSistersCount > 1) {
                            // Deux s≈ìurs germaines ou plus - 2/3
                            const sistersShare = 2/3;
                            const sharePerSister = sistersShare / fullSistersCount;
                            heirs.push({
                                name: `S≈ìur germaine${fullSistersCount > 1 ? 's' : ''}`,
                                share: sharePerSister * fullSistersCount,
                                amount: (estateValue * sharePerSister * fullSistersCount).toFixed(2),
                                count: fullSistersCount,
                                type: 'fixed'
                            });
                            totalShares += sistersShare;
                        } else {
                            // Fr√®res et s≈ìurs germains - syst√®me du 'Asabah
                            const sisterUnit = fullSistersCount;
                            const brotherUnit = fullBrothersCount * 2;
                            const totalUnits = sisterUnit + brotherUnit;
                            const sharePerUnit = remainingShare / totalUnits;
                            
                            if (fullBrothersCount > 0) {
                                const brotherShare = sharePerUnit * 2;
                                heirs.push({
                                    name: `Fr√®re germain${fullBrothersCount > 1 ? 's' : ''}`,
                                    share: brotherShare * fullBrothersCount,
                                    amount: (estateValue * brotherShare * fullBrothersCount).toFixed(2),
                                    count: fullBrothersCount,
                                    type: 'asabah'
                                });
                            }
                            
                            if (fullSistersCount > 0) {
                                const sisterShare = sharePerUnit;
                                heirs.push({
                                    name: `S≈ìur germaine${fullSistersCount > 1 ? 's' : ''}`,
                                    share: sisterShare * fullSistersCount,
                                    amount: (estateValue * sisterShare * fullSistersCount).toFixed(2),
                                    count: fullSistersCount,
                                    type: 'asabah'
                                });
                            }
                        }
                    }
                }
                
                // Fr√®res et s≈ìurs maternels
                const maternalSiblingsCount = maternalBrothersCount + maternalSistersCount;
                if (maternalSiblingsCount > 0) {
                    let maternalShare;
                    if (maternalSiblingsCount === 1) {
                        maternalShare = 1/6;
                    } else {
                        maternalShare = 1/3;
                    }
                    
                    const sharePerMaternalSibling = maternalShare / maternalSiblingsCount;
                    
                    if (maternalBrothersCount > 0) {
                        heirs.push({
                            name: `Fr√®re maternel${maternalBrothersCount > 1 ? 's' : ''}`,
                            share: sharePerMaternalSibling * maternalBrothersCount,
                            amount: (estateValue * sharePerMaternalSibling * maternalBrothersCount).toFixed(2),
                            count: maternalBrothersCount,
                            type: 'fixed'
                        });
                    }
                    
                    if (maternalSistersCount > 0) {
                        heirs.push({
                            name: `S≈ìur maternelle${maternalSistersCount > 1 ? 's' : ''}`,
                            share: sharePerMaternalSibling * maternalSistersCount,
                            amount: (estateValue * sharePerMaternalSibling * maternalSistersCount).toFixed(2),
                            count: maternalSistersCount,
                            type: 'fixed'
                        });
                    }
                    
                    totalShares += maternalShare;
                }
            }

            // GRANDS-PARENTS - PRIORIT√â 4
            if (!fatherPresent && !motherPresent && childrenCount === 0 && 
                grandsonsBySonCount === 0 && granddaughtersBySonCount === 0) {
                
                // Grand-p√®re paternel
                if (paternalGrandfatherPresent) {
                    heirs.push({
                        name: 'Grand-p√®re paternel',
                        share: 1/6,
                        amount: (estateValue * 1/6).toFixed(2),
                        count: 1,
                        type: 'fixed'
                    });
                    totalShares += 1/6;
                }
                
                // Grand-m√®re paternelle
                if (paternalGrandmotherPresent) {
                    heirs.push({
                        name: 'Grand-m√®re paternelle',
                        share: 1/6,
                        amount: (estateValue * 1/6).toFixed(2),
                        count: 1,
                        type: 'fixed'
                    });
                    totalShares += 1/6;
                }
                
                // Grands-parents maternels
                const maternalGrandparentsCount = (maternalGrandfatherPresent ? 1 : 0) + 
                                                 (maternalGrandmotherPresent ? 1 : 0);
                if (maternalGrandparentsCount > 0) {
                    const sharePerMaternalGrandparent = (1/3) / maternalGrandparentsCount;
                    
                    if (maternalGrandfatherPresent) {
                        heirs.push({
                            name: 'Grand-p√®re maternel',
                            share: sharePerMaternalGrandparent,
                            amount: (estateValue * sharePerMaternalGrandparent).toFixed(2),
                            count: 1,
                            type: 'fixed'
                        });
                    }
                    
                    if (maternalGrandmotherPresent) {
                        heirs.push({
                            name: 'Grand-m√®re maternelle',
                            share: sharePerMaternalGrandparent,
                            amount: (estateValue * sharePerMaternalGrandparent).toFixed(2),
                            count: 1,
                            type: 'fixed'
                        });
                    }
                    
                    totalShares += 1/3;
                }
            }

            // Affichage des r√©sultats
            displayResults(heirs, estateValue);
            switchTab('resultats');
        }

        function displayResults(heirs, estateValue) {
            const resultsDiv = document.getElementById('results');
            const heirsListDiv = document.getElementById('heirsList');
            
            heirsListDiv.innerHTML = '';

            let totalDistributed = 0;

            heirs.forEach(heir => {
                if (heir.type !== 'excluded') {
                    totalDistributed += parseFloat(heir.amount);
                }
                
                const heirElement = document.createElement('div');
                heirElement.className = 'heir-item';
                
                if (heir.type === 'excluded') {
                    heirElement.style.background = '#f8d7da';
                    heirElement.style.border = '1px solid #f5c6cb';
                }
                
                let shareType = '';
                if (heir.type === 'fixed') {
                    shareType = '<br><small style="color: #666;">Part fixe (Fard)</small>';
                } else if (heir.type === 'asabah') {
                    shareType = '<br><small style="color: #666;">Part r√©siduelle (Asabah)</small>';
                } else if (heir.type === 'excluded') {
                    shareType = '<br><small style="color: #dc3545;">Non h√©ritant</small>';
                }
                
                let noteHtml = '';
                if (heir.note) {
                    noteHtml = `<br><small style="color: #dc3545; font-style: italic;">${heir.note}</small>`;
                }
                
                heirElement.innerHTML = `
                    <div>
                        <span class="heir-name">${heir.name} ${heir.count > 1 ? `(${heir.count})` : ''}</span>
                        ${shareType}
                        ${noteHtml}
                    </div>
                    <div style="text-align: right;">
                        <div>${(heir.share * 100).toFixed(2)}%</div>
                        <div class="heir-share" style="${heir.type === 'excluded' ? 'color: #dc3545;' : ''}">
                            ${parseFloat(heir.amount).toLocaleString('fr-FR')} ‚Ç¨
                        </div>
                    </div>
                `;
                heirsListDiv.appendChild(heirElement);
            });

            // Affichage du total distribu√©
            const totalElement = document.createElement('div');
            totalElement.className = 'heir-item';
            totalElement.style.background = '#e8f5e8';
            totalElement.innerHTML = `
                <span class="heir-name"><strong>Total distribu√©</strong></span>
                <div style="text-align: right;">
                    <div><strong>${((totalDistributed / estateValue) * 100).toFixed(2)}%</strong></div>
                    <div class="heir-share"><strong>${totalDistributed.toLocaleString('fr-FR')} ‚Ç¨</strong></div>
                </div>
            `;
            heirsListDiv.appendChild(totalElement);

            // V√©rification s'il reste de l'argent non distribu√©
            const remaining = estateValue - totalDistributed;
            if (Math.abs(remaining) > 0.01) {
                const remainingElement = document.createElement('div');
                remainingElement.className = 'heir-item';
                remainingElement.style.background = remaining > 0 ? '#fff3cd' : '#ffe6e6';
                remainingElement.innerHTML = `
                    <span class="heir-name"><strong>${remaining > 0 ? 'Reste √† distribuer' : 'D√©passement'}</strong></span>
                    <div style="text-align: right;">
                        <div><strong>${((remaining / estateValue) * 100).toFixed(2)}%</strong></div>
                        <div class="heir-share" style="color: ${remaining > 0 ? '#e67e22' : '#e74c3c'};">
                            <strong>${Math.abs(remaining).toLocaleString('fr-FR')} ‚Ç¨</strong>
                        </div>
                    </div>
                `;
                heirsListDiv.appendChild(remainingElement);
                
                if (remaining > 0) {
                    const explanationElement = document.createElement('div');
                    explanationElement.className = 'note';
                    explanationElement.innerHTML = `
                        üí° <strong>Explication :</strong> Le reste de la succession doit √™tre distribu√© aux h√©ritiers r√©siduels (Asabah) 
                        selon les r√®gles de priorit√©. En l'absence d'h√©ritiers r√©siduels, le reste revient √† Bayt al-Mal (tr√©sor public musulman).
                    `;
                    heirsListDiv.appendChild(explanationElement);
                }
            }

            resultsDiv.style.display = 'block';
        }
    </script>
</body>
</html>
